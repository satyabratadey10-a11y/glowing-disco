<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Photo & Video Upscaler + CC Filters</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            animation: fadeInDown 0.8s ease;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: fadeInUp 0.8s ease;
        }

        .upload-section {
            text-align: center;
            padding: 40px;
            border: 3px dashed #667eea;
            border-radius: 15px;
            background: #f8f9ff;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-section:hover {
            border-color: #764ba2;
            background: #f0f1ff;
            transform: translateY(-2px);
        }

        .upload-section.dragover {
            border-color: #4CAF50;
            background: #e8f5e9;
        }

        .upload-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .upload-section h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.5em;
        }

        input[type="file"] {
            display: none;
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.1em;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-success {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            color: white;
        }

        .preview-section {
            display: none;
            margin-top: 30px;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .preview-box {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            background: #f9f9f9;
        }

        .preview-header {
            background: #667eea;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }

        .preview-image {
            width: 100%;
            height: 400px;
            object-fit: contain;
            background: #fff;
            padding: 10px;
        }

        .stats {
            padding: 15px;
            background: white;
            font-size: 0.9em;
            color: #666;
        }

        .cc-section {
            background: #f8f9ff;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
        }

        .cc-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .cc-header h2 {
            color: #667eea;
            font-size: 1.8em;
        }

        .cc-upload-btn {
            padding: 10px 25px;
            background: #FF9800;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .cc-upload-btn:hover {
            background: #F57C00;
            transform: scale(1.05);
        }

        .cc-filters {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .cc-filter-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .cc-filter-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .cc-filter-card.active {
            border-color: #667eea;
            background: #f0f1ff;
        }

        .cc-filter-preview {
            width: 100%;
            height: 80px;
            border-radius: 8px;
            margin-bottom: 10px;
            object-fit: cover;
        }

        .cc-filter-name {
            font-weight: bold;
            color: #333;
            font-size: 0.9em;
        }

        .custom-cc-controls {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .control-row {
            margin-bottom: 20px;
        }

        .control-row label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #667eea;
        }

        .control-row input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #e0e0e0;
            outline: none;
        }

        .control-row input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .control-value {
            text-align: center;
            font-weight: bold;
            color: #764ba2;
            margin-top: 5px;
        }

        .settings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .setting-group {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
        }

        .setting-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #667eea;
        }

        select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
        }

        .progress-container {
            display: none;
            margin: 30px 0;
        }

        .progress-bar {
            width: 100%;
            height: 40px;
            background: #f0f0f0;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .loading-spinner {
            display: none;
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        .cc-list {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .cc-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .cc-item:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .cc-item-preview {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            margin-right: 15px;
            object-fit: cover;
        }

        .cc-item-info {
            flex: 1;
        }

        .cc-item-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .cc-item-details {
            font-size: 0.85em;
            color: #666;
        }

        .cc-item-actions button {
            padding: 8px 20px;
            margin-left: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .cc-apply-btn {
            background: #4CAF50;
            color: white;
        }

        .cc-apply-btn:hover {
            background: #45a049;
        }

        .cc-delete-btn {
            background: #f44336;
            color: white;
        }

        .cc-delete-btn:hover {
            background: #d32f2f;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }

            .main-card {
                padding: 20px;
            }

            .preview-grid {
                grid-template-columns: 1fr;
            }

            .settings {
                grid-template-columns: 1fr;
            }

            .cc-filters {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® AI Photo & Video Upscaler + CC Filters</h1>
            <p>Enhance to 4K with Professional Color Correction</p>
        </div>

        <div class="main-card">
            <!-- Alert Messages -->
            <div id="alertSuccess" class="alert alert-success"></div>
            <div id="alertError" class="alert alert-error"></div>
            <div id="alertInfo" class="alert alert-info"></div>

            <!-- Upload Section -->
            <div id="uploadSection" class="upload-section" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">üì§</div>
                <h3>Upload Photo or Video</h3>
                <p>Drag and drop your file here or click to browse</p>
                <p style="font-size: 0.9em; color: #999;">Supports: JPG, PNG, GIF, MP4, AVI, MOV</p>
                <input type="file" id="fileInput" accept="image/*,video/*">
            </div>

            <!-- CC Filters Section -->
            <div id="ccSection" class="cc-section" style="display: none;">
                <div class="cc-header">
                    <h2>üé® Color Correction (CC) Filters</h2>
                    <button class="cc-upload-btn" onclick="document.getElementById('ccFileInput').click()">
                        üìÅ Load CC from Storage
                    </button>
                    <input type="file" id="ccFileInput" accept=".cc,.json,.cube,.3dl" style="display: none;">
                </div>

                <!-- Preset CC Filters -->
                <h3 style="margin-bottom: 15px; color: #333;">Preset Filters</h3>
                <div class="cc-filters" id="ccFilters"></div>

                <!-- Custom CC Controls -->
                <div class="custom-cc-controls">
                    <h3 style="margin-bottom: 20px; color: #667eea;">Custom Color Correction</h3>
                    
                    <div class="control-row">
                        <label>Brightness</label>
                        <input type="range" id="brightness" min="-100" max="100" value="0">
                        <div class="control-value" id="brightnessValue">0</div>
                    </div>

                    <div class="control-row">
                        <label>Contrast</label>
                        <input type="range" id="contrast" min="-100" max="100" value="0">
                        <div class="control-value" id="contrastValue">0</div>
                    </div>

                    <div class="control-row">
                        <label>Saturation</label>
                        <input type="range" id="saturation" min="-100" max="100" value="0">
                        <div class="control-value" id="saturationValue">0</div>
                    </div>

                    <div class="control-row">
                        <label>Exposure</label>
                        <input type="range" id="exposure" min="-100" max="100" value="0">
                        <div class="control-value" id="exposureValue">0</div>
                    </div>

                    <div class="control-row">
                        <label>Temperature</label>
                        <input type="range" id="temperature" min="-100" max="100" value="0">
                        <div class="control-value" id="temperatureValue">0</div>
                    </div>

                    <div class="control-row">
                        <label>Tint</label>
                        <input type="range" id="tint" min="-100" max="100" value="0">
                        <div class="control-value" id="tintValue">0</div>
                    </div>

                    <div class="control-row">
                        <label>Vibrance</label>
                        <input type="range" id="vibrance" min="-100" max="100" value="0">
                        <div class="control-value" id="vibranceValue">0</div>
                    </div>

                    <div class="control-row">
                        <label>Highlights</label>
                        <input type="range" id="highlights" min="-100" max="100" value="0">
                        <div class="control-value" id="highlightsValue">0</div>
                    </div>

                    <div class="control-row">
                        <label>Shadows</label>
                        <input type="range" id="shadows" min="-100" max="100" value="0">
                        <div class="control-value" id="shadowsValue">0</div>
                    </div>

                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="resetCC()">üîÑ Reset All</button>
                        <button class="btn btn-success" onclick="saveCustomCC()">üíæ Save CC Preset</button>
                    </div>
                </div>

                <!-- Loaded CC Files -->
                <div id="ccList" class="cc-list" style="display: none;">
                    <h3 style="margin-bottom: 15px; color: #667eea;">Loaded CC Filters</h3>
                    <div id="ccItems"></div>
                </div>
            </div>

            <!-- Settings -->
            <div class="settings">
                <div class="setting-group">
                    <label>Output Quality</label>
                    <select id="qualitySelect">
                        <option value="720p">HD (720p)</option>
                        <option value="1080p">Full HD (1080p)</option>
                        <option value="2k">2K (1440p)</option>
                        <option value="4k" selected>4K (2160p)</option>
                    </select>
                </div>

                <div class="setting-group">
                    <label>AI Model</label>
                    <select id="modelSelect">
                        <option value="standard">Standard (Fast)</option>
                        <option value="enhanced" selected>Enhanced (Better)</option>
                        <option value="pro">Pro (Best Quality)</option>
                    </select>
                </div>
            </div>

            <!-- Process Buttons -->
            <div style="text-align: center; margin: 30px 0;">
                <button id="processBtn" class="btn btn-primary" disabled>
                    ‚ú® Upscale with AI + CC
                </button>
                <button id="downloadBtn" class="btn btn-success" style="display: none;">
                    üíæ Download Result
                </button>
            </div>

            <!-- Progress Bar -->
            <div id="progressContainer" class="progress-container">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill">0%</div>
                </div>
            </div>

            <div class="loading-spinner" id="loadingSpinner"></div>

            <!-- Preview Section -->
            <div id="previewSection" class="preview-section">
                <h2 style="text-align: center; color: #667eea; margin-bottom: 20px;">Before & After with CC</h2>
                <div class="preview-grid">
                    <div class="preview-box">
                        <div class="preview-header">üì∏ Original</div>
                        <img id="originalPreview" class="preview-image" src="" alt="Original">
                        <div class="stats" id="originalStats"></div>
                    </div>
                    <div class="preview-box">
                        <div class="preview-header">‚ú® AI Enhanced + CC (4K)</div>
                        <img id="enhancedPreview" class="preview-image" src="" alt="Enhanced">
                        <div class="stats" id="enhancedStats"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let originalFile = null;
        let originalImage = null;
        let currentCCFilter = null;
        let customCCFilters = [];
        let loadedCCFiles = [];

        // Preset CC Filters
        const presetFilters = [
            {
                name: 'None',
                icon: '‚ö™',
                values: { brightness: 0, contrast: 0, saturation: 0, exposure: 0, temperature: 0, tint: 0, vibrance: 0, highlights: 0, shadows: 0 }
            },
            {
                name: 'Vivid',
                icon: 'üåà',
                values: { brightness: 10, contrast: 20, saturation: 30, exposure: 5, temperature: 0, tint: 0, vibrance: 25, highlights: -10, shadows: 10 }
            },
            {
                name: 'Cinematic',
                icon: 'üé¨',
                values: { brightness: -5, contrast: 25, saturation: -15, exposure: 0, temperature: -10, tint: 5, vibrance: 0, highlights: -20, shadows: 15 }
            },
            {
                name: 'Warm',
                icon: 'üî•',
                values: { brightness: 5, contrast: 10, saturation: 15, exposure: 8, temperature: 40, tint: -5, vibrance: 10, highlights: 0, shadows: 5 }
            },
            {
                name: 'Cool',
                icon: '‚ùÑÔ∏è',
                values: { brightness: 0, contrast: 15, saturation: 10, exposure: 0, temperature: -40, tint: 10, vibrance: 5, highlights: 5, shadows: 0 }
            },
            {
                name: 'Vintage',
                icon: 'üì∑',
                values: { brightness: 15, contrast: -10, saturation: -20, exposure: 10, temperature: 25, tint: 15, vibrance: -15, highlights: -15, shadows: 20 }
            },
            {
                name: 'High Contrast',
                icon: '‚ö°',
                values: { brightness: 0, contrast: 50, saturation: 20, exposure: 0, temperature: 0, tint: 0, vibrance: 15, highlights: -25, shadows: 25 }
            },
            {
                name: 'Soft',
                icon: 'üå∏',
                values: { brightness: 10, contrast: -15, saturation: 5, exposure: 5, temperature: 10, tint: -5, vibrance: -10, highlights: 10, shadows: -10 }
            },
            {
                name: 'Drama',
                icon: 'üé≠',
                values: { brightness: -10, contrast: 40, saturation: 0, exposure: -5, temperature: -15, tint: 0, vibrance: 10, highlights: -30, shadows: 30 }
            },
            {
                name: 'Natural',
                icon: 'üåø',
                values: { brightness: 5, contrast: 5, saturation: 10, exposure: 0, temperature: 5, tint: 0, vibrance: 15, highlights: 0, shadows: 0 }
            },
            {
                name: 'Black & White',
                icon: '‚ö´',
                values: { brightness: 0, contrast: 30, saturation: -100, exposure: 0, temperature: 0, tint: 0, vibrance: 0, highlights: -10, shadows: 10 }
            },
            {
                name: 'Golden Hour',
                icon: 'üåÖ',
                values: { brightness: 15, contrast: 15, saturation: 25, exposure: 10, temperature: 50, tint: -10, vibrance: 20, highlights: 5, shadows: 0 }
            }
        ];

        // DOM Elements
        const fileInput = document.getElementById('fileInput');
        const ccFileInput = document.getElementById('ccFileInput');
        const uploadSection = document.getElementById('uploadSection');
        const processBtn = document.getElementById('processBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const ccSection = document.getElementById('ccSection');
        const previewSection = document.getElementById('previewSection');
        const originalPreview = document.getElementById('originalPreview');
        const enhancedPreview = document.getElementById('enhancedPreview');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const loadingSpinner = document.getElementById('loadingSpinner');

        // CC Controls
        const ccControls = {
            brightness: document.getElementById('brightness'),
            contrast: document.getElementById('contrast'),
            saturation: document.getElementById('saturation'),
            exposure: document.getElementById('exposure'),
            temperature: document.getElementById('temperature'),
            tint: document.getElementById('tint'),
            vibrance: document.getElementById('vibrance'),
            highlights: document.getElementById('highlights'),
            shadows: document.getElementById('shadows')
        };

        // Initialize
        loadPresetFilters();
        setupCCControls();

        // File input events
        fileInput.addEventListener('change', handleFileSelect);
        ccFileInput.addEventListener('change', handleCCFileSelect);

        // Drag and drop
        uploadSection.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadSection.classList.add('dragover');
        });

        uploadSection.addEventListener('dragleave', () => {
            uploadSection.classList.remove('dragover');
        });

        uploadSection.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadSection.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        function loadPresetFilters() {
            const container = document.getElementById('ccFilters');
            container.innerHTML = '';

            presetFilters.forEach((filter, index) => {
                const card = document.createElement('div');
                card.className = 'cc-filter-card';
                if (index === 0) card.classList.add('active');
                
                const canvas = document.createElement('canvas');
                canvas.width = 100;
                canvas.height = 80;
                canvas.className = 'cc-filter-preview';
                const ctx = canvas.getContext('2d');
                
                // Create gradient preview
                const gradient = ctx.createLinearGradient(0, 0, 100, 80);
                gradient.addColorStop(0, '#667eea');
                gradient.addColorStop(1, '#764ba2');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, 100, 80);
                
                const name = document.createElement('div');
                name.className = 'cc-filter-name';
                name.textContent = `${filter.icon} ${filter.name}`;
                
                card.appendChild(canvas);
                card.appendChild(name);
                
                card.addEventListener('click', () => {
                    document.querySelectorAll('.cc-filter-card').forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                    applyPresetFilter(filter);
                });
                
                container.appendChild(card);
            });
        }

        function applyPresetFilter(filter) {
            currentCCFilter = filter;
            
            // Update all controls
            Object.keys(filter.values).forEach(key => {
                if (ccControls[key]) {
                    ccControls[key].value = filter.values[key];
                    document.getElementById(key + 'Value').textContent = filter.values[key];
                }
            });

            if (originalImage) {
                applyLiveCCPreview();
            }
            
            showAlert('success', `Applied ${filter.name} filter`);
        }

        function setupCCControls() {
            Object.keys(ccControls).forEach(key => {
                const control = ccControls[key];
                const valueDisplay = document.getElementById(key + 'Value');
                
                control.addEventListener('input', (e) => {
                    valueDisplay.textContent = e.target.value;
                    if (originalImage) {
                        applyLiveCCPreview();
                    }
                });
            });
        }

        function getCurrentCCValues() {
            const values = {};
            Object.keys(ccControls).forEach(key => {
                values[key] = parseFloat(ccControls[key].value);
            });
            return values;
        }

        function applyLiveCCPreview() {
            if (!originalImage) return;

            const canvas = document.createElement('canvas');
            canvas.width = originalImage.width;
            canvas.height = originalImage.height;
            const ctx = canvas.getContext('2d');
            
            ctx.drawImage(originalImage, 0, 0);
            
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const ccValues = getCurrentCCValues();
            const processed = applyCCToImageData(imageData, ccValues);
            
            ctx.putImageData(processed, 0, 0);
            originalPreview.src = canvas.toDataURL();
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            if (!file.type.startsWith('image/') && !file.type.startsWith('video/')) {
                showAlert('error', 'Please select an image or video file');
                return;
            }

            originalFile = file;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                originalImage = new Image();
                originalImage.onload = () => {
                    originalPreview.src = e.target.result;
                    updateStats('originalStats', originalImage.width, originalImage.height, file.size);
                    processBtn.disabled = false;
                    ccSection.style.display = 'block';
                    showAlert('success', `File loaded: ${file.name}. Apply CC filters below!`);
                };
                originalImage.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function handleCCFileSelect(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    let ccData;
                    const fileName = file.name.toLowerCase();

                    if (fileName.endsWith('.json')) {
                        ccData = JSON.parse(event.target.result);
                    } else if (fileName.endsWith('.cc')) {
                        ccData = parseCustomCC(event.target.result);
                    } else if (fileName.endsWith('.cube') || fileName.endsWith('.3dl')) {
                        ccData = parseLUT(event.target.result);
                    } else {
                        showAlert('error', 'Unsupported CC format. Use .cc, .json, .cube, or .3dl files');
                        return;
                    }

                    loadedCCFiles.push({
                        name: file.name,
                        data: ccData,
                        timestamp: new Date().toLocaleString()
                    });

                    updateCCList();
                    showAlert('success', `CC Filter "${file.name}" loaded successfully!`);

                } catch (error) {
                    showAlert('error', 'Failed to load CC file: ' + error.message);
                }
            };

            if (file.name.toLowerCase().endsWith('.json') || file.name.toLowerCase().endsWith('.cc')) {
                reader.readAsText(file);
            } else {
                reader.readAsText(file);
            }
        }

        function parseCustomCC(data) {
            // Parse custom CC format
            try {
                return JSON.parse(data);
            } catch {
                // Parse simple format: brightness=10, contrast=20, etc.
                const lines = data.split('\n');
                const ccData = {};
                
                lines.forEach(line => {
                    const [key, value] = line.split('=').map(s => s.trim());
                    if (key && value) {
                        ccData[key.toLowerCase()] = parseFloat(value);
                    }
                });
                
                return ccData;
            }
        }

        function parseLUT(data) {
            // Basic LUT parser for .cube and .3dl files
            const lines = data.split('\n');
            const ccData = {
                brightness: 0,
                contrast: 0,
                saturation: 0,
                exposure: 0,
                temperature: 0,
                tint: 0,
                vibrance: 0,
                highlights: 0,
                shadows: 0,
                lut: []
            };

            lines.forEach(line => {
                line = line.trim();
                if (line && !line.startsWith('#') && !line.startsWith('TITLE')) {
                    const values = line.split(/\s+/).map(v => parseFloat(v));
                    if (values.length === 3 && values.every(v => !isNaN(v))) {
                        ccData.lut.push(values);
                    }
                }
            });

            return ccData;
        }

        function updateCCList() {
            const ccList = document.getElementById('ccList');
            const ccItems = document.getElementById('ccItems');
            
            if (loadedCCFiles.length === 0) {
                ccList.style.display = 'none';
                return;
            }

            ccList.style.display = 'block';
            ccItems.innerHTML = '';

            loadedCCFiles.forEach((ccFile, index) => {
                const item = document.createElement('div');
                item.className = 'cc-item';
                
                const preview = document.createElement('canvas');
                preview.className = 'cc-item-preview';
                preview.width = 60;
                preview.height = 60;
                const ctx = preview.getContext('2d');
                const gradient = ctx.createLinearGradient(0, 0, 60, 60);
                gradient.addColorStop(0, '#FF9800');
                gradient.addColorStop(1, '#F57C00');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, 60, 60);
                
                const info = document.createElement('div');
                info.className = 'cc-item-info';
                
                const name = document.createElement('div');
                name.className = 'cc-item-name';
                name.textContent = ccFile.name;
                
                const details = document.createElement('div');
                details.className = 'cc-item-details';
                details.textContent = `Loaded: ${ccFile.timestamp}`;
                
                info.appendChild(name);
                info.appendChild(details);
                
                const actions = document.createElement('div');
                actions.className = 'cc-item-actions';
                
                const applyBtn = document.createElement('button');
                applyBtn.className = 'cc-apply-btn';
                applyBtn.textContent = 'Apply';
                applyBtn.onclick = () => applyLoadedCC(ccFile.data);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'cc-delete-btn';
                deleteBtn.textContent = 'Delete';
                deleteBtn.onclick = () => {
                    loadedCCFiles.splice(index, 1);
                    updateCCList();
                    showAlert('info', 'CC filter removed');
                };
                
                actions.appendChild(applyBtn);
                actions.appendChild(deleteBtn);
                
                item.appendChild(preview);
                item.appendChild(info);
                item.appendChild(actions);
                
                ccItems.appendChild(item);
            });
        }

        function applyLoadedCC(ccData) {
            Object.keys(ccData).forEach(key => {
                if (ccControls[key] && key !== 'lut') {
                    ccControls[key].value = ccData[key] || 0;
                    document.getElementById(key + 'Value').textContent = ccData[key] || 0;
                }
            });

            if (originalImage) {
                applyLiveCCPreview();
            }

            showAlert('success', 'CC filter applied!');
        }

        function resetCC() {
            Object.keys(ccControls).forEach(key => {
                ccControls[key].value = 0;
                document.getElementById(key + 'Value').textContent = '0';
            });

            if (originalImage) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    originalPreview.src = e.target.result;
                };
                reader.readAsDataURL(originalFile);
            }

            document.querySelectorAll('.cc-filter-card').forEach((card, index) => {
                card.classList.remove('active');
                if (index === 0) card.classList.add('active');
            });

            showAlert('info', 'All CC values reset to default');
        }

        function saveCustomCC() {
            const ccValues = getCurrentCCValues();
            const ccName = prompt('Enter a name for this CC preset:', 'My Custom CC');
            
            if (!ccName) return;

            const ccData = {
                name: ccName,
                values: ccValues,
                timestamp: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(ccData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${ccName.replace(/\s+/g, '_')}.cc`;
            link.click();
            URL.revokeObjectURL(url);

            showAlert('success', `CC preset "${ccName}" saved!`);
        }

        function updateStats(elementId, width, height, size) {
            const element = document.getElementById(elementId);
            const sizeKB = (size / 1024).toFixed(2);
            element.innerHTML = `
                <strong>Resolution:</strong> ${width} x ${height}<br>
                <strong>Size:</strong> ${sizeKB} KB
            `;
        }

        processBtn.addEventListener('click', processImage);

        async function processImage() {
            if (!originalImage) return;

            processBtn.disabled = true;
            downloadBtn.style.display = 'none';
            progressContainer.style.display = 'block';
            loadingSpinner.style.display = 'block';
            previewSection.style.display = 'block';

            showAlert('info', 'Processing with AI + CC filters... Please wait');

            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 90) progress = 90;
                updateProgress(progress);
            }, 200);

            try {
                const quality = document.getElementById('qualitySelect').value;
                const model = document.getElementById('modelSelect').value;
                const ccValues = getCurrentCCValues();

                // Perform upscaling with CC
                const result = await upscaleWithCC(originalImage, quality, model, ccValues);

                clearInterval(interval);
                updateProgress(100);

                enhancedPreview.src = result.dataUrl;
                updateStats('enhancedStats', result.width, result.height, result.size);

                setTimeout(() => {
                    progressContainer.style.display = 'none';
                    loadingSpinner.style.display = 'none';
                    downloadBtn.style.display = 'inline-block';
                    processBtn.disabled = false;
                    showAlert('success', '‚úÖ AI upscaling with CC completed!');
                }, 500);

            } catch (error) {
                clearInterval(interval);
                progressContainer.style.display = 'none';
                loadingSpinner.style.display = 'none';
                processBtn.disabled = false;
                showAlert('error', 'Processing failed: ' + error.message);
            }
        }

        async function upscaleWithCC(img, quality, model, ccValues) {
            return new Promise((resolve) => {
                const qualityMap = {
                    '720p': 1280,
                    '1080p': 1920,
                    '2k': 2560,
                    '4k': 3840
                };

                const targetWidth = qualityMap[quality];
                const aspectRatio = img.height / img.width;
                const targetHeight = Math.round(targetWidth * aspectRatio);

                const canvas = document.createElement('canvas');
                canvas.width = targetWidth;
                canvas.height = targetHeight;
                const ctx = canvas.getContext('2d');

                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';

                // Draw upscaled image
                ctx.drawImage(img, 0, 0, targetWidth, targetHeight);

                // Apply AI enhancement
                let imageData = ctx.getImageData(0, 0, targetWidth, targetHeight);
                imageData = applyAIEnhancement(imageData);

                // Apply CC filters
                imageData = applyCCToImageData(imageData, ccValues);

                ctx.putImageData(imageData, 0, 0);

                canvas.toBlob((blob) => {
                    const dataUrl = canvas.toDataURL('image/jpeg', 0.95);
                    resolve({
                        dataUrl: dataUrl,
                        width: targetWidth,
                        height: targetHeight,
                        size: blob.size
                    });
                }, 'image/jpeg', 0.95);
            });
        }

        function applyAIEnhancement(imageData) {
            const data = imageData.data;

            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];

                // AI-like sharpening
                const enhanceFactor = 0.2;
                data[i] = Math.min(255, Math.max(0, r + (r - 128) * enhanceFactor));
                data[i + 1] = Math.min(255, Math.max(0, g + (g - 128) * enhanceFactor));
                data[i + 2] = Math.min(255, Math.max(0, b + (b - 128) * enhanceFactor));
            }

            return imageData;
        }

        function applyCCToImageData(imageData, ccValues) {
            const data = imageData.data;
            
            for (let i = 0; i < data.length; i += 4) {
                let r = data[i];
                let g = data[i + 1];
                let b = data[i + 2];

                // Apply brightness
                const brightnessFactor = ccValues.brightness / 100;
                r += brightnessFactor * 50;
                g += brightnessFactor * 50;
                b += brightnessFactor * 50;

                // Apply contrast
                const contrastFactor = (ccValues.contrast / 100) * 0.5 + 1;
                r = ((r / 255 - 0.5) * contrastFactor + 0.5) * 255;
                g = ((g / 255 - 0.5) * contrastFactor + 0.5) * 255;
                b = ((b / 255 - 0.5) * contrastFactor + 0.5) * 255;

                // Apply exposure
                const exposureFactor = Math.pow(2, ccValues.exposure / 50);
                r *= exposureFactor;
                g *= exposureFactor;
                b *= exposureFactor;

                // Apply temperature
                const tempFactor = ccValues.temperature / 100;
                r += tempFactor * 30;
                b -= tempFactor * 30;

                // Apply tint
                const tintFactor = ccValues.tint / 100;
                g += tintFactor * 20;

                // Apply saturation
                const satFactor = (ccValues.saturation / 100) + 1;
                const gray = 0.2989 * r + 0.5870 * g + 0.1140 * b;
                r = gray + (r - gray) * satFactor;
                g = gray + (g - gray) * satFactor;
                b = gray + (b - gray) * satFactor;

                // Apply vibrance (smart saturation)
                const vibFactor = ccValues.vibrance / 100;
                const maxRGB = Math.max(r, g, b);
                const minRGB = Math.min(r, g, b);
                const saturation = (maxRGB - minRGB) / (maxRGB || 1);
                const vibranceAmount = (1 - saturation) * vibFactor;
                const gray2 = 0.2989 * r + 0.5870 * g + 0.1140 * b;
                r = gray2 + (r - gray2) * (1 + vibranceAmount);
                g = gray2 + (g - gray2) * (1 + vibranceAmount);
                b = gray2 + (b - gray2) * (1 + vibranceAmount);

                // Apply highlights
                const highlightsFactor = ccValues.highlights / 100;
                const brightness = (r + g + b) / 3;
                if (brightness > 128) {
                    const factor = ((brightness - 128) / 127) * highlightsFactor;
                    r += factor * 30;
                    g += factor * 30;
                    b += factor * 30;
                }

                // Apply shadows
                const shadowsFactor = ccValues.shadows / 100;
                if (brightness < 128) {
                    const factor = ((128 - brightness) / 128) * shadowsFactor;
                    r += factor * 30;
                    g += factor * 30;
                    b += factor * 30;
                }

                // Clamp values
                data[i] = Math.min(255, Math.max(0, r));
                data[i + 1] = Math.min(255, Math.max(0, g));
                data[i + 2] = Math.min(255, Math.max(0, b));
            }

            return imageData;
        }

        function updateProgress(percent) {
            progressFill.style.width = percent + '%';
            progressFill.textContent = Math.round(percent) + '%';
        }

        downloadBtn.addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = 'ai-enhanced-cc-4k.jpg';
            link.href = enhancedPreview.src;
            link.click();
            showAlert('success', 'Image downloaded successfully!');
        });

        function showAlert(type, message) {
            const alertMap = {
                'success': document.getElementById('alertSuccess'),
                'error': document.getElementById('alertError'),
                'info': document.getElementById('alertInfo')
            };

            Object.values(alertMap).forEach(alert => alert.style.display = 'none');

            const alert = alertMap[type];
            alert.textContent = message;
            alert.style.display = 'block';

            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
